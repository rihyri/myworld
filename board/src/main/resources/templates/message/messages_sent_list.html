<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
</head>
<body>
<div layout:fragment="content">
    <div class="container my-3" style="height: 80%;">
        <div class="d-flex justify-content-between">
            <div class="message_menu w-25">
                <a th:href="@{/messages/received/list}">수신쪽지함<span th:text="${#lists.size(unreadMessages)}"></span></a>
                <a th:href="@{/messages/sent}" class="message_active">발신쪽지함</a>
                <a th:href="@{/messages/insert}">쪽지보내기</a>
                <a th:href="@{/messages/self}">내게 쓴 쪽지함</a>
            </div>
            <div class="message_table w-75">
                <table class="table">
                    <thead>
                    <th>제목</th>
                    <th>작성일시</th>
                    <th>작성자</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="message, loop : ${paging}">
                        <td class="w-50">
                            <a th:href="@{|/message/sent/detail/${message.id}|}" th:text="${message.title}"></a>
                        </td>
                        <td th:text="${#temporals.format(message.createDate, 'yyyy-MM-dd HH:mm')}"></td>
                        <td th:text="${message.receiver.nickname}"></td>
                    </tr>
                    </tbody>
                </table>
                <div th:if="${!paging.isEmpty()}">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
                            <a class="page-link" th:href="@{/messages/sent(page=${paging.number-1})}" th:unless="${paging.first}">이전</a>
                        </li>
                        <li th:each="i : ${#numbers.sequence(0, paging.totalPages-1)}" th:classappend="${i == paging.number} ? 'active' : ''">
                            <a class="page-link" th:href="@{/messages/sent(page=${i})}" th:text="${i + 1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
                            <a class="page-link" th:href="@{/messages/sent(page=${paging.number+1})}" th:unless="${paging.last}">다음</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>
<th:block layout:fragment="javascript">
    <script>
        $(document).ready(function() {
           const page_elements = document.getElementsByClassName("page-link");
            Array.from(page_elements).forEach(function(element) {
                element.addEventListener('click', function() {
                document.getElementById('page').value = this.dataset.page;
                document.getElementById('searchForm').submit();
            });
    });

    const btn_search = document.getElementById("btn_search");
    btn_search.addEventListener('click', function() {
        document.getElementById('kw').value = document.getElementById('search_kw').value;
        document.getElementById('page').value = 0;  // 검색버튼을 클릭할 경우 0페이지부터 조회한다.
        document.getElementById('searchForm').submit();
            });
    });
    </script>
</th:block>
</body>
</html>
